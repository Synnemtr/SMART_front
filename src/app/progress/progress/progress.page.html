<ion-header>
  <ion-toolbar>
    <ion-title> Gamification-page </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card *ngIf="profile" class="card">

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Progress: {{ getGoalLabel(profile.goal) }}</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        <form [formGroup]="updateProfileForm">
          <ion-progress-bar [value]="profile.goal_progress / progressbarSubgoal(profile.sub_goal)"></ion-progress-bar> 
          Sub-Goal: {{ profile.sub_goal }}
          <ion-grid>
            <ion-row>
              <ion-col>
                <ng-container>
                  <ion-input class="primary-input" placeholder="Goal progress" type="number" formControlName="goal_progress"></ion-input>
                </ng-container>
              </ion-col>
              <ion-col> 
                <ion-button [disabled]="!updateProfileForm.valid" expand="block" (click)="updateGoal()">Update</ion-button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </form>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Achievements</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let achievement of activeAchievements; let i = index">
            <ion-grid *ngIf="i === 0">
              <ion-row>
                <ion-col>
                  {{ achievement.name }}
                  <ion-progress-bar value="{{achievement.current_points/achievement.threshold}}"></ion-progress-bar>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
        </ion-list>
        
        <ion-button fill="clear" (click)="toAchievements()">To achievements</ion-button>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Badges</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
          <ion-item *ngFor="let badge of userBadges; let i = index">
            <ion-grid *ngIf="i===0">
              <ion-row>
                <ion-col>Laste BADGE obtained: </ion-col>
                <ion-col>{{ badge.name }}</ion-col>
                <ion-col>, at date: </ion-col>
                <ion-col>{{ badge.date_earned }}</ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>

        <ion-button fill="clear" (click)="toBadges()">To badges</ion-button>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Quiz</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        <ion-item *ngIf="currentQuestion">
          <ion-grid>
            <ion-row>
              <ion-col>{{ currentQuestion.question }}</ion-col>
            </ion-row>
            <ion-row *ngFor="let option of [currentQuestion.option_one, currentQuestion.option_two, currentQuestion.option_three, currentQuestion.option_four]">
              <ion-col>
                <ion-button expand="block" (click)="handleAnswer(option)">{{ option }}</ion-button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
        
        <p>{{ message }}</p>
        <p>Your score: {{ score }}</p>
        
        <ion-button expand="block" (click)="startQuiz()">Start Quiz</ion-button>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Leaderboard Points</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-item>
          <ion-grid>
            <ion-row>
              <ion-col>Username</ion-col>
              <ion-col>Total Points</ion-col>
            </ion-row>
            <ion-row>
              <ion-col>{{ user.username }}</ion-col>
              <ion-col>{{ profile.total_points }}</ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title> Achievement Ranking</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        <ion-item>
          <ion-grid>
            <ion-row>
              <ion-col> Username  </ion-col>
              <ion-col> Number of achievements </ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
        <ion-list>
          <ion-item *ngFor="let user of rankingAchievements">
            <ion-grid>
              <ion-row>
                <ion-col>{{ user.username }}</ion-col>
                <ion-col>{{ user.achievement_count }}</ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Positive feedback</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        TODO: display random positive feedback from backend-API-call using positiveFeedback() function ?
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header expand="full" class="title" color="primary">
        <ion-card-title>Game element placeholder</ion-card-title>
      </ion-card-header>
    
      <ion-card-content>
        <!-- <p *ngIf="profile.HEXAD_12_type === gameElements.HEXAD_12"> Game-element: {{ (userGameElements | slice:0:1)[0].name }}</p> -->
      </ion-card-content>
    </ion-card>


  </ion-card>
</ion-content>